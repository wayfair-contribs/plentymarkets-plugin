name: build-ui

on:
  workflow_dispatch:
  push:
    paths: 
      - ./angular/**
      - ./ui/**

jobs:
  build-then-push:

    runs-on: ubuntu-latest

    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: setup-node
      uses: actions/setup-node@v1
      with:
        node-version: '12.x'
    - name: build-ui-with-npm
      working-directory: ./angular
      env:
        CI: true  
      run: |
        npm install
        npm run build
        npm test --if-present   
    - name: push-ui-changes
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
        git add -A
        git commit -m "automated UI code generation via github action"
        git push
